% !Mode:: "TeX:UTF-8"
%% 请使用 XeLaTeX 编译本文.
% \documentclass{WHUBachelor}% 选项 forprint: 交付打印时添加, 避免彩色链接字迹打印偏淡. 即使用下一行:
 \documentclass[forprint]{WHUBachelor}
\usepackage{cite} 
\usepackage{amsmath, amsfonts, amssymb} % math equations, symbols
\usepackage[english]{babel}
\usepackage{color}      % color content
\usepackage{graphicx}   % import figures
\usepackage{url}        % hyperlinks
\usepackage{bm}         % bold type for equations
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{epstopdf}
\usepackage{epsfig}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{esvect}
\usepackage{listings}
\usepackage[framed,numbered,autolinebreaks,useliterate]{mcode}
\usepackage{subfig}
\usepackage{float}
\begin{document}
%%%%%%% 下面的内容, 据实填空.


\StudentNumber{力6} % 填写自己的学号

\title{\\有限元法基础\\桥梁设计竞赛报告}

\advisor{张雄教授}

\author{毕恺峰$\,$ 胡昌平$\,$ 黄轩宇 $\,$易泽吉$\,$张逸葑}                            % 作者名字

\Cmajor{工程力学}                  % 专业中文名

\Cschoolname{航天航空学院}          % 学院名

\date{二〇一八年三月}                    % 日期, 要注意和英文日期一致!!


%-----------------------------------------------------------------------------
\pdfbookmark[0]{封面}{title}         % 封面页加到 pdf 书签
\maketitle
\frontmatter
\pagenumbering{Roman}              % 正文之前的页码用大写罗马字母编号.
%-----------------------------------------------------------------------------

%==========================把目录加入到书签==============================%%%%%%
\pdfbookmark[0]{目录}{toc}

\mainmatter %% 以下是正文、
\tableofcontents
\chapter{摘要}
\chapter{桥梁的基本选择与设计思路}
\section{悬索斜拉桥}
\section{拱形桥}
\section{xx桥}
\section{xx桥}
\chapter{桥梁的Abaqus实现}
\section{零件的设计}
\section{有限元单元类型的选择}
\section{有限元单元尺寸的选择}
\section{施加约束条件}
\chapter{桥梁的cost计算}

\section{Abaqus-Python脚本读取过程}
在桥梁的大体结构设计确定之后，在进行几何参数改良时，如果在CAE界面改参数将变得非常繁琐，而将模型进行python录制后直接读入相关参数进行计算将非常方便；与此同时，由于我们最终需要集中优化的参数为桥梁的最大位移，桥梁的总造价和承载应力情况，而CAE界面只能查看应力的大体分布情况，无法对所有单元的应力分布情况做一个具体的分析，因此我们还需要利用python脚本对整个Abaqus数据结构进行有选择性的数据读取，其中主要包括节点位移，单元应力，以及单元对应的高斯点坐标，单元几何属性等；与此同时我们可以利用matlab等软件作为python的外部接口，即为python脚本提供输入数据（inp文件），并对输出数据进行相应的分析。整个脚本的程序逻辑结构如图\ref{4-1}所示：

\begin{figure}[H]
\centering  
\includegraphics[width = .8\textwidth]{1.png} 
\caption{python后处理设计逻辑} 
\label{4-1} 
\end{figure}

\subsection{ODB对象数据结构：}

如图\ref{4-2}所示：ODB对象主要对包含计算模型对象数据（Model Data）和计算结果数据(Result Data)，计算模型对象数据包含装配体(rootAssenbly)
、零件(parts) 、界面分类(sectionCategories)、材料(materials) 等子对象，计算结果数据steps包含分析步(step)
、帧(frame) 、历史变量输出(historyoutputs) 和场变量输出(field outputs) 等。场变量的读取路径:odb.Setps{[}{]}.frames{[}{]}.fieldOutputs{[}{]};

场变量包括:应力分量-'S';应-'E'; 位移-'U';

历史变量的读取路径:odb.Setps{[}{]}.historyRegions{[}{]}.historyOutputs{[}{]};

\begin{figure}[H]
\centering  
\includegraphics[width = .8\textwidth]{2.png} 
\caption{Abaque odb数据结构示意图} 
\label{4-2} 
\end{figure}

\subsection{MDB对象数据结构}

如图\ref{4-3}所示：MDB对象主要对包含计算模型对象数据(Model Data) 和工作对象数据(Job Data) ，其中model对象，包含零件(parts)
、材料(materials) 等子对象。零件(parts) 子对象包含单元(elements) 、集合(sets) 和节点(nodes)
子对象，其下又包含编号(label) 、坐标(coordinate) 、单元所属节点组(connectivity)等属性。

几何集的读取路径:mdb.models{[}{]}.parts{[}{]}.sets{[}{]}.odb.rootAssembly.instance{[}{]}.elementSets{[}{]}；

几何集所属单元，节点信息读取路径:

单元编号:mdb.models{[}{]}.parts{[}{]}.sets{[}{]}.elements{[}{]}.elementLabel.odb.rootAssembly.Instances{[}{]}.elementSets{[}{]}.elements{[}{]}.
elementLabel；

单元所属节点组:mdb.models{[}{]}.parts{[}{]}.sets{[}{]}.elements{[}{]}.Connectivity.odb.
rootAssembly.instances{[}{]}.elementSets{[}{]}． elements{[}{]}. connectivity；

节点坐标:mdb.models{[}{]}.parts{[}{]}.sets{[}{]}.nodes{[}{]}.coordinates；

\begin{figure}[H]
\centering  
\includegraphics[width = .8\textwidth]{3.png} 
\caption{Abaque mdb数据结构示意图} 
\label{4-3} 
\end{figure}

\subsection{最大位移读取}

我们在odb对象中把位移场’U’的数据读取出来，然后对节点进行循环得到最大的位移数值，如图\ref{4-4}所示：

\begin{figure}[H]
\centering  
\includegraphics[width = .8\textwidth]{4.png} 
\caption{最大位移读取程序示意图} 
\label{4-4} 
\end{figure}

\subsection{单元应力和最大许用应力}

首先先在odb对象中把应力场’S’中的数据读取出来，然后再将其写入txt文件中，同时输入相应的单元类型和单元号，以便之后对应相应的单元属性，如图\ref{4-5}所示：

\begin{figure}[H]
\centering  
\includegraphics[width = .8\textwidth]{4.png} 
\caption{应力读取程序示意图} 
\label{4-5} 
\end{figure}

\subsection{单元属性读取}

最后我们在mdb对象中得到所有单元的材料属性和坐标等参数，写入到另一个txt文件中，如图\ref{4-6}所示：

\begin{figure}[H]
\centering  
\includegraphics[width = .8\textwidth]{5.png} 
\caption{单元属性读取程序示意图} 
\label{4-6} 
\end{figure}

之后再将相关的单元应力和单元信息参数一同导入到matlab中进行相关的循环检索，利用超过许用应力的单元对应到其单元类型，利用其单元数据计算出其体积；最后检索所有的单元信息得到所有单元的体积总和，一方面计算相应的参数

\chapter{桥梁的优化过程}
对于桥梁优化的整体指标为竞赛说明文件中所述的cost function为
\begin {equation} 
\Pi_{i}=\sqrt{0.4\left(\frac{d_{i}}{a_{1, i}}\right)^{2}+0.4\left(\frac{p_{i}}{a_{2, i}}\right)^{2}+0.2\left(\frac{v}{a_{3, i}}\right)^{2}}
 \end {equation}
其中$d_i$为桥梁平面的最大位移。同时记单元中有$\frac{3}{4}$高斯点在测试工况下达到许用应力的0.8倍的单元为危险单元。$p_i$反应了危险单元体积占整体单元体积的比例。\par
由于无从知晓其他组的各个指标，我们假设各组的指标间的比例关系与我们类似，所以我们的优化过程中简单的将代价函数替换为
\begin {equation} 
\Pi_{i}=\sqrt{0.4\left(\frac{d_{i}}{b_{1, i}}\right)^{2}+0.4\left(\frac{p_{i}}{b_{2, i}}\right)^{2}+0.2\left(\frac{v}{b_{3, i}}\right)^{2}}
 \end {equation}
将原有的分母部分改成遗传算法中出现的分项指标的最大值。将此作为我们的优化目标。\par
整体的优化思路为，首先选取不同样式的桥，分析桥的构型，确定基本设计方案，以及设计方案中的可变参数，其次通过Abaqus的Python脚本接口，参数化的生成桥，之后同样通过Python脚本导出相关的各项指标，如桥面最大位移，以及危险单元占比，之后将桥的相关参数及各项指标导入优化算法，计算出最终的cost，同时分析计算出下一步的各项参数，在Abaqus中画出桥，并计算cost，之后不断迭代，达到指定步长后提取出全局最优解及相关参数。
\section{算法的选择}
\subsection{离散与连续}
算法的选择上有两个层面的选择问题，一是离散和连续算法的选择，二是确定不同种类的离散或连续算法。首先对各项指标分析，工程造价这一项指标可以比较显示的表达成不同单元体积与材料成本的乘积，但桥面最大位移，以及危险单元占比可能很难显示的表达，因此整体的代价函数中有一部分为有解析描述另一部分无解析描述。单纯采用连续的算法并不可行，此时可以采取的思路包括，采取分裂算子的思路，将连续指标与离散指标分裂开来，分部的优化迭代，但分裂算子方法较为复杂，同时对于纯离散问题，算子分裂也并没有成熟稳定的解决方案，因此我们选择了最后一种方案，即将整题的问题考虑为一个离散问题，直接用离散方法对其求解。\par
\subsection{离散算法的选择}
模拟退火算法具有摆脱局部最优解的能力，能够以随机搜索技术从概率的意义上找出目标函数的全局最小点。但是，由于模拟退火算法对整个搜索空间的状况了解不多，不便于使搜索过程进入最有希望的搜索区域，使得模拟退火算法的运算效率不高。模拟退火算法对参数（如初始温度）的依赖性较强，且进化速度慢。\par
遗传算法具有良好的全局搜索能力，可以快速地将解空间中的全体解搜索出，而不会陷入局部最优解的快速下降陷阱；并且利用它的内在并行性，可以方便地进行分布式计算，加快求解速度。但是遗传算法的局部搜索能力较差，导致单纯的遗传算法比较费时，在进化后期搜索效率较低。\par
综上所述，结合了此处桥梁设计问题的特点，以及算法的效率和可行性分析，因为结果随参数的波动可能较为剧烈，为较快的搜索到全局最优解的邻域，我们选取了遗传算法。
\section{遗传算法的简介}
生物在漫长的进化过程中，从低等生物一直发展到高等生物。这是自然环境选择的结果。人们研究生物进化现象，总结出进化过程包括复制、杂交、变异、竞争和选择。一些学者从生物遗传、进化的过程得到启发，提出了遗传算法（GA）。算法中称遗传的生物体为个体，个体对环境的适应程度用适应值表示。适应值取决于个体的染色体，在算法中染色体常用一串数字表示，数字串中的一位对应一个基因。一定数量的个体组成一个群体。对所有个体进行选择、交叉和变异等操作，生成新的群体，称为新一代。\par
遗传算法属于进化算法Evolutionary Algorithms的一种,它通过模仿自然界的选择与遗传的机理来寻找最优解。遗传算法有三个基本算子:选择、交叉和变异。数值方法求解这一问题的主要手段是迭代运算。一般的迭代方法容易陷入局部极小的陷阱而出现"死循环"现象，使迭代无法进行。遗传算法很好地克服了这个缺点，是一种全局优化算法。\par
\section{程序设计思路}
\subsection{编码}
（1）选择合适的编码方案，将各参量拼接转换为染色体。联系实际问题，为每个待优化的变量规定上界与下界，如桥墩的间隔这一参数就小于河床的宽度，大于要求的至少150m。之后确定每个参量的基因组长度，即其离散的密度和优化的精度，对于二进制编码，优化的精度为$\frac{t_{upper-limit}-t_{lower-limit}}{2^n}$。将上下限中的点等分，对应到二进制编码中。\par
（2）选择合适的参数，包括每一步迭代中的群体大小、交叉概率$P_{crossover}$和变异概率$P_{mutation}$\par
（3）确定适应值函数$f(x)$，考虑到这里的适应值为正值，所以对cost函数取相反数之后加上一个常数即可。
\subsection{初始化} 
在最开始的桥的基础上，提取出参数，同时施加一些扰动。将这些作为第一代群体的一部分，另一部分由简单的随机染色体组成，这样既保证了合理解的邻域附近比较全面的搜索，同时完全随机的染色体也保证了群体的基因多样性。初始解的存在保证了优化算法的结果一定是优于最开始的计算结果。
\subsection{繁衍}
\subsection{交叉}
（1）对每串产生[0，1]间随机数，若r>pc，则该串参加交叉操作，如此选出参加交叉的一组后，随机配对。\par
（2）对每一对，产生[1，m]间的随机数以确定交叉的位置。\par
 (3) 将一对染色体m点后的位置互换
\subsection{变异}
如变异概率为Pm，则可能变异的位数的期望值为Pm ×m×M，每一位以等概率变异。具体为对每一串中的每一位产生[0，1]间的随机数r，若r<Pm，则该位发生反转，如对染色体二进制编码为数字0变为1，1变为0。对群组不断进行变异和交叉互换操作，直到下一群体中个体数目达到所要求的M。
\subsection{选择}
对群体中每一染色体（串）计算其适应值，同时计算群体的总适应值。计算每一串的选择概率$Pi=\frac{fi}{F}$及累计概率。选择一般通过简单的古典概型描述，产生[0，1]间随机数r，根据r所在区间选取对应的染色体个体。
\subsection{算法总结}
由于选择概率是由适应值决定的，即适应值大的染色体入选概率也较大，使选择起到"择优汰劣"的作用。交叉使染色体交换信息，结合选择规则，使优秀信息得以保存，不良信息被遗弃。变异是基因中得某一位发生突变，以达到产生确实有实质性差异的新品种。遗传算法虽是一种随机算法，但它是有导向的，它所使用的"按概率随机选择"方法是在有方向的搜索方法中的一种工具。正是这种独特的搜索方法，使遗传算法自然地避开了其它最优化算法常遇到的局部最小陷阱。\par
遗传算法与传统的优化方法（枚举，启发式等）相比较，以生物进化为原型，具有很好的收敛性，在计算精度要求时，计算时间少，鲁棒性高等都是它的优点。
\section{优化实例}
对于这一优化算法我们选取了简单的示例进行验证，简单考虑一个悬索斜拉桥，具体的参数包括桥墩的跨度，每个支架所对应的悬索根数，桥墩的尺寸，悬索的面积。简单基于悬臂梁的推导，$d\propto x^4,M\propto x^2,M\propto \sigma_{max}^2,n \propto L^{-1}$。我们可以发现桥墩的跨度与桥面最大位移成四次方关系，假设单元的最大应力值呈线性分布，因此与危险单元占比个数呈二次方关系，与造价成反比关系。对于悬索根数，$d \propto L^4,L \propto n^{-1}$,可以推出$d \propto n^{-4}$,与桥墩跨度类似，与危险单元个数呈负二次方关系，与造价成正比。桥墩的尺寸与悬索的截面积均与造价成正比，考虑其对危险单元个数与桥面最大位移影响不大。
\begin{figure}[H]
\centering
    \includegraphics[width=.9\textwidth]{GA.png}\hfill
  \caption{Symmetry and asymmetry lines and Boudary condition}
\label{fig:1}
\end{figure}
优化结果如图所示，选取的桥梁跨度为160m，选取的悬索根数（每段）52。
\chapter{优化服务器}
\section{Abaqus的GPU优化构架}
\section{服务器的CPU-GPU取舍}
\chapter{结论}
最终我们选取的桥梁如下。。。Abaqus相关文件见。。。。总体的cost为。。。。
\bibliographystyle{plain}
\bibliography{bridge_report}
\cleardoublepage
\end{document}

%%%============================================================================================================%%%

%%%=== 参考文献 ========%%%




